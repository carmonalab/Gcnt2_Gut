---
title: "Analysis of GCNT2 Expression Profile"
author: A. Mihaylov <aleksandar.mihaylov@epfl.ch>
---

# Preparing Finely Annotated Dataset

## Downloading Finely Annotated Dataset

```{r downloading_processed_dataset}
ds_name <- "SalasA_2023_GSE214695"
home.path <- file.path(getwd(), ds_name)
output_data_path <- file.path(home.path, "output")

size <- "whole" # "light" or "whole"

# cmc stands for colonic mucosa cells
cmc <- readRDS(file.path(output_data_path, paste0(ds_name, 
                                                  sprintf("_finely_annotated_%s.rds", size))))
```

## Extracting GCNT2 Counts 

```{r extracting_gcnt2}
counts <- Seurat::GetAssayData(cmc, assay = "RNA", slot = "data")
gcnt2_counts <- counts["GCNT2", ]
cmc$GCNT2 <- gcnt2_counts
```

# Initial Analysis per Cell Type

## ANOVA Test

```{r anova_test}
cat("All Cells Considered","\n", "\n")
gcnt2.cell_type.expression <- cmc@meta.data[, c("manual_annotation", "GCNT2")]
gcnt2.aov.model <- aov(gcnt2.cell_type.expression$GCNT2 ~ gcnt2.cell_type.expression$manual_annotation)
print(summary(gcnt2.aov.model))
cat("-----------------------------------------","\n")
print(TukeyHSD(gcnt2.aov.model))
```

## Initial Diagnostic Plots

```{r in_diganostic_plots}
Seurat::VlnPlot(cmc, features = "GCNT2", group.by = "manual_annotation") + 
  ggplot2::ggtitle("Violin Plots of GCNT2 Expression across Cell Types")

ggplot2::ggplot(gcnt2.cell_type.expression, 
                ggplot2::aes(x = manual_annotation, y = GCNT2)) + 
  ggplot2::geom_boxplot(fill="slateblue", alpha=0.2) + 
  ggplot2::xlab("Cell Type") +
  ggplot2::ylab("GCNT2 Expression") +
  ggplot2::ggtitle("Boxplot of GCNT2 Expression across Cell Types")

Seurat::RidgePlot(cmc, features = "GCNT2", group.by = "manual_annotation") +
  ggplot2::ggtitle("Ridge Plot of GCNT2 Expression across Cell Types")

Seurat::FeaturePlot(cmc, features = "GCNT2") +
  ggplot2::ggtitle("Feature Plot of GCNT2 Expression across Cell Types")
```

Clearly, most cells, independent of their type, do not express GCNT2. Therefore, for downstream analyses, let us focus solely on the cells which do express GCNT2.

```{r subsetting_cells}
filtered_cmc <- subset(cmc, subset = GCNT2 > 0)
cat("Number of cells left in Seurat object:", length(Seurat::Cells(filtered_cmc)))
```

# Analysis per Cell Type 

## Statistical Tests

```{r stat_tests}
cat("Only GCNT2 Expressing Cells Considered","\n", "\n")
gcnt2.cell_type.expression <- filtered_cmc@meta.data[, c("manual_annotation", "GCNT2")]
gcnt2.aov.model <- aov(gcnt2.cell_type.expression$GCNT2 ~ gcnt2.cell_type.expression$manual_annotation)
print(summary(gcnt2.aov.model))
cat("-----------------------------------------","\n")
print(TukeyHSD(gcnt2.aov.model))
```

## Diagnostic Plots

```{r plots_per_cell_type}
Seurat::VlnPlot(filtered_cmc, "GCNT2", group.by = "manual_annotation") +
  ggplot2::ggtitle("Violin Plots of GCNT2 Expression across Cell Types Omitting GCNT2 Non-expressing Cells") 

ggplot2::ggplot(gcnt2.cell_type.expression, 
                ggplot2::aes(x = manual_annotation, y = GCNT2)) + 
  ggplot2::geom_boxplot(fill="slateblue", alpha=0.2) + 
  ggplot2::xlab("Cell Type") +
  ggplot2::ylab("GCNT2 Expression") +
  ggplot2::ggtitle("Boxplot of GCNT2 Expression across Cell Types Omitting GCNT2 Non-expressing Cells")

Seurat::RidgePlot(filtered_cmc, features = "GCNT2", group.by = "manual_annotation") +
  ggplot2::ggtitle("Ridge Plot of GCNT2 Expression across Cell Types")
```

# Analysis per Condition

## Statistical Tests

```{r stat_tests}
cat("All Cells Considered","\n", "\n")
gcnt2.condition.expression <- cmc@meta.data[, c("Treatment", "GCNT2")]
gcnt2.aov.model <- aov(gcnt2.condition.expression$GCNT2 ~ gcnt2.condition.expression$Treatment)
print(summary(gcnt2.aov.model))
cat("-----------------------------------------","\n")
print(TukeyHSD(gcnt2.aov.model))

cat("---------------------------------------------------------------------------------------------------","\n")

cat("Only GCNT2 Expressing Cells Considered","\n", "\n")
gcnt2.condition.expression <- filtered_cmc@meta.data[, c("Treatment", "GCNT2")]
gcnt2.aov.model <- aov(gcnt2.condition.expression$GCNT2 ~ gcnt2.condition.expression$Treatment)
print(summary(gcnt2.aov.model))
cat("-----------------------------------------","\n")
print(TukeyHSD(gcnt2.aov.model))
```

## Diagnostic Plots

```{r plots_per_condition}
Seurat::VlnPlot(filtered_cmc, "GCNT2", group.by = "Treatment") +
  ggplot2::ggtitle("Violin Plots of GCNT2 Expression across Conditions Omitting GCNT2 Non-expressing Cells") 

ggplot2::ggplot(gcnt2.condition.expression, 
                ggplot2::aes(x = Treatment, y = GCNT2)) + 
  ggplot2::geom_boxplot(fill="slateblue", alpha=0.2) + 
  ggplot2::xlab("Condition") +
  ggplot2::ylab("GCNT2 Expression") +
  ggplot2::ggtitle("Boxplot of GCNT2 Expression across Conditions Omitting GCNT2 Non-expressing Cells")

Seurat::RidgePlot(filtered_cmc, features = "GCNT2", group.by = "Treatment") +
  ggplot2::ggtitle("Ridge Plot of GCNT2 Expression across Conditions Omitting GCNT2 Non-expressing Cells")
```




